{% extends "admin/admin_base.html" %}

{% block head %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
{% endblock head %}

{% block heading %}
<h2 class="fw-semibold mb-0" style="font-size: 1.5rem; color: #1e293b;">Coupons</h2>
{% endblock heading %}

{% block content %}
<div class="container-fluid mt-4">
  <!-- Filters/Search -->
  <div class="card shadow-sm mb-4" style="border-radius: 10px; border: none;">
    <div class="card-body" style="padding: 1.5rem;">
      <form method="get" class="row g-3 align-items-end">
        <div class="col-md-4">
          <label class="form-label">Search</label>
          <input type="text" name="q" value="{{ query }}" class="form-control" placeholder="Code or description">
        </div>
        <div class="col-md-3">
          <label class="form-label">Status</label>
          <select name="status" class="form-select">
            <option value="all" {% if status_filter == 'all' %}selected{% endif %}>All</option>
            <option value="active" {% if status_filter == 'active' %}selected{% endif %}>Active</option>
            <option value="inactive" {% if status_filter == 'inactive' %}selected{% endif %}>Inactive</option>
            <option value="expired" {% if status_filter == 'expired' %}selected{% endif %}>Expired</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Discount Type</label>
          <select name="discount_type" class="form-select">
            <option value="all" {% if discount_type_filter == 'all' %}selected{% endif %}>All</option>
            <option value="percentage" {% if discount_type_filter == 'percentage' %}selected{% endif %}>Percentage</option>
            <option value="fixed" {% if discount_type_filter == 'fixed' %}selected{% endif %}>Fixed Amount</option>
          </select>
        </div>
        <div class="col-md-2 d-flex gap-2">
          <button class="btn btn-outline-secondary w-50" type="button" onclick="window.location='?';">Clear</button>
          <button class="btn btn-primary w-50" type="submit" style="background-color:#2563eb;">Filter</button>
        </div>
      </form>
      <div class="mt-3">
        <a href="{% url 'add_coupon' %}" class="btn btn-primary" style="background-color:#2563eb;">Add Coupon</a>
      </div>
    </div>
  </div>

  <!-- Stats -->
  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="card shadow-sm" style="border-radius:10px; border:none;">
        <div class="card-body"><div class="text-muted">Total Coupons</div><div class="fw-semibold fs-4">{{ total_coupons }}</div></div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm" style="border-radius:10px; border:none;">
        <div class="card-body"><div class="text-muted">Active</div><div class="fw-semibold fs-4">{{ active_coupons }}</div></div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm" style="border-radius:10px; border:none;">
        <div class="card-body"><div class="text-muted">Expired</div><div class="fw-semibold fs-4">{{ expired_coupons }}</div></div>
      </div>
    </div>
  </div>

  <!-- Table -->
  <div class="card shadow-sm" style="border-radius: 10px; border: none;">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover align-middle" style="font-size:0.9rem;">
          <thead class="table-light">
            <tr>
              <th>Code</th>
              <th>Type</th>
              <th>Value</th>
              <th>Min Amount</th>
              <th>Max Discount</th>
              <th>Valid From</th>
              <th>Valid Until</th>
              <th>Status</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for c in coupons %}
            <tr>
              <td>{{ c.code }}</td>
              <td>{{ c.discount_type|title }}</td>
              <td>{% if c.discount_type == 'percentage' %}{{ c.discount_value }}%{% else %}₹{{ c.discount_value }}{% endif %}</td>
              <td>₹{{ c.minimum_amount }}</td>
              <td>{% if c.maximum_discount %}₹{{ c.maximum_discount }}{% else %}-{% endif %}</td>
              <td>{{ c.valid_from|date:'Y-m-d H:i' }}</td>
              <td>{{ c.valid_until|date:'Y-m-d H:i' }}</td>
              <td>
                {% if c.is_active %}
                  <span class="badge bg-success">Active</span>
                {% else %}
                  <span class="badge bg-secondary">Inactive</span>
                {% endif %}
              </td>
              <td class="text-end">
                <a href="{% url 'edit_coupon' c.id %}" class="btn btn-sm btn-primary">Edit</a>
                <a href="{% url 'toggle_coupon_status' c.id %}" class="btn btn-sm btn-outline-secondary">Change Status</a>
              </td>
            </tr>
            {% empty %}
            <tr><td colspan="9" class="text-center text-muted">No coupons found.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <nav>
        <ul class="pagination justify-content-center">
          {% if coupons.has_previous %}
          <li class="page-item"><a class="page-link" href="?page={{ coupons.previous_page_number }}">Prev</a></li>
          {% endif %}
          {% for i in coupons.paginator.page_range %}
          <li class="page-item{% if coupons.number == i %} active{% endif %}"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
          {% endfor %}
          {% if coupons.has_next %}
          <li class="page-item"><a class="page-link" href="?page={{ coupons.next_page_number }}">Next</a></li>
          {% endif %}
        </ul>
      </nav>
    </div>
  </div>
</div>

{% endblock %}

