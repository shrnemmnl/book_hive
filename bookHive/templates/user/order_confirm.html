{% load static %}
<!-- Header Placeholder -->
{% include 'includes/header.html' %}

{% block confirmation_css %}
  <link rel="stylesheet" href="{% static 'css/confirmation_style.css' %}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
{% endblock confirmation_css %}

<!-- Confirmation Section -->
<section class="confirmation-section py-5 bg-light">
  <div class="container">
    <!-- Confirmation Header -->
    <div class="confirmation-header text-center mb-5">
      <i class="bi bi-check-circle-fill text-success" style="font-size: 4rem;"></i>
      <h1 class="mt-3 mb-2 fw-semibold">Order Confirmed!</h1>
      <p class="text-muted">Thank you for your purchase. Your order has been successfully placed.</p>
      <p class="text-muted mb-0">Order ID: <strong>#{{ order.order_id }}</strong> | Placed on: <strong>{{ order.created_at|date:"F d, Y" }}</strong></p>
    </div>

    <div class="row justify-content-center">
      <div class="col-lg-8">
        <!-- Order Details -->
        <div class="order-details bg-white p-4 shadow-sm rounded mb-4">
          <h4 class="section-title mb-4"><span class="section-number">1</span> Order Details</h4>
          <div class="row">
            <!-- Shipping Information -->
            <div class="col-md-6 mb-4">
              <h6 class="fw-semibold mb-3">Shipping Information</h6>
              <p class="text-muted mb-0">
                {{ order.user.first_name }} {{ order.user.last_name }}<br>
                {{ order.address.address_type|title }}<br>
                {{ order.address.street }}<br>
                {{ order.address.city }}, {{ order.address.state }} {{ order.address.postal_code }}<br>
                Phone: {{ order.address.phone }}
              </p>
            </div>
            <!-- Payment Method -->
            <div class="col-md-6 mb-4">
              <h6 class="fw-semibold mb-3">Payment Method</h6>
              <p class="text-muted mb-0">
                {% if order.payment_method == 'razorpay' %}
                  <i class="bi bi-credit-card me-2"></i>Razorpay
                {% elif order.payment_method == 'wallet' %}
                  <i class="bi bi-wallet2 me-2"></i>Wallet
                {% else %}
                  <i class="bi bi-cash-coin me-2"></i>Cash on Delivery
                {% endif %}
              </p>
            </div>
          </div>
        </div>

        <!-- Order Items -->
        <div class="order-items bg-white p-4 shadow-sm rounded mb-4">
          <h4 class="section-title mb-4"><span class="section-number">2</span> Order Items</h4>
          <div class="items-list">
            {% for item in order_items %}
              <div class="card mb-3 border-0 shadow-sm">
                <div class="card-body p-3">
                  <div class="row align-items-center">
                    <div class="col-3">
                      <img src="{{ item.product_variant.product.image.url }}" alt="{{ item.product_variant.product.book_title }}" class="img-fluid rounded" style="height: 60px; object-fit: cover;" />
                    </div>
                    <div class="col-9">
                      <h6 class="mb-1 fw-semibold">{{ item.product_variant.product.book_title }}</h6>
                      <small class="text-muted d-block mb-1">{{ item.product_variant.product.author }}</small>
                      <div class="d-flex justify-content-between align-items-center">
                        <div class="quantity-info">
                          <span class="badge bg-light text-dark">Qty: {{ item.quantity }}</span>
                          {% if item.product_variant.format %}<small class="text-muted ms-1">({{ item.product_variant.format }})</small>{% endif %}
                        </div>
                        <div class="price-info text-end fw-bold">₹{{ item.total_amount |floatformat:2 }}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            {% empty %}
              <div class="text-center py-4">
                <i class="bi bi-cart3 fs-1 text-muted mb-2"></i>
                <p class="text-muted mb-0">No items in this order.</p>
              </div>
            {% endfor %}
          </div>
        </div>

        <!-- Order Summary -->
        <div class="order-summary bg-white p-4 shadow-sm rounded">
          <h4 class="section-title mb-4"><span class="section-number">3</span> Order Summary</h4>
          <div class="order-totals">
            <div class="d-flex justify-content-between mb-2">
              <span>Subtotal ({{ order_items.count }} item{{ order_items.count|pluralize }})</span>
              <span class="fw-medium">₹{{ order.net_amount|floatformat:2 }}</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>Shipping</span>
              <span class="text-success fw-medium">Free</span>
            </div>
            {% if order.discount_amount %}
              <div class="d-flex justify-content-between mb-2">
                <span class="text-success">Discount {% if order.coupon_code %}<small>({{ order.coupon_code }})</small>{% endif %}</span>
                <span class="text-success fw-medium">-₹{{ order.discount_amount|floatformat:2 }}</span>
              </div>
            {% endif %}
            <hr class="my-3">
            <div class="d-flex justify-content-between align-items-center mb-3 p-2 bg-light rounded">
              <span class="fw-bold fs-5">Total</span>
              <span class="total-price fs-4 mb-0 text-primary fw-bold">₹{{ order.net_amount|floatformat:2 }}</span>
            </div>
            {% if order.total_savings %}
              <div class="text-center mb-3">
                <small class="text-success"><i class="bi bi-tag-fill me-1"></i> You saved ₹{{ order.total_savings|floatformat:2 }} on this order!</small>
              </div>
            {% endif %}
          </div>
          <a href="{% url 'user_order' %}" class="btn btn-primary w-100 mt-3 text-decoration-none" id="checkout-button">
            <i class="bi bi-cart-check-fill me-2"></i>Veiw orders
          </a>
          <div class="text-center mt-3">
            <small class="text-muted"><i class="bi bi-shield-lock-fill me-1"></i> Secure checkout powered by SSL encryption</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Footer Placeholder -->
{% include 'includes/footer.html' %}

<!-- Bootstrap JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>

<style>
/* Global Styles */
.confirmation-section {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background-color: #f5f6f5;
}

.container {
  max-width: 1200px;
}

/* Section Title */
.section-title {
  font-size: 22px;
  font-weight: 600;
  margin-bottom: 24px;
  display: flex;
  align-items: center;
  color: #1f2937;
}

.section-number {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  background-color: #2563eb;
  color: #fff;
  border-radius: 50%;
  font-size: 18px;
  margin-right: 12px;
}

/* Order Details */
.order-details, .order-items, .order-summary {
  border-radius: 12px;
  border: 1px solid #e5e7eb;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.order-details p, .order-items p {
  font-size: 14px;
  line-height: 1.7;
  color: #4b5563;
}

/* Order Items */
.items-list .card {
  border-radius: 8px;
  transition: transform 0.2s ease;
}

.items-list .card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

/* Order Summary */
.order-totals .bg-light {
  border-radius: 8px;
  border: 1px solid #e5e7eb;
}

.total-price {
  color: #2563eb;
  font-weight: 700;
}

/* Buttons */
.btn-primary {
  background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
  border: none;
  font-weight: 600;
  padding: 10px 20px;
  transition: all 0.3s ease;
}

.btn-primary:hover {
  background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(37, 99, 235, 0.3);
}

/* Responsive Adjustments */
@media (max-width: 767px) {
  .confirmation-header h1 {
    font-size: 1.75rem;
  }

  .confirmation-header .bi-check-circle-fill {
    font-size: 3rem;
  }

  .items-list .col-3 {
    flex: 0 0 20%;
    max-width: 20%;
  }

  .items-list .col-9 {
    flex: 0 0 80%;
    max-width: 80%;
  }
}
</style>