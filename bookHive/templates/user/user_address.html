{% load static %} 
{% include 'includes/header.html' %} 

<div class="container-fluid">
  <div class="row">
    <!-- Include sidebar -->
    <div class="col-lg-2">{% include 'user/UserProfile/sidebar.html' %}</div>

    <!-- Main Content Column -->
    <div class="col-lg-10 py-3">
      <div class="content-wrapper bg-white p-4 shadow-lg rounded">
        <h4 class="mb-4">Your Addresses</h4>
        <p class="text-muted mb-4">Manage your delivery addresses</p>
        
        <button
          class="btn btn-primary mb-4"
          data-bs-toggle="modal"
          data-bs-target="#addAddressModal"
        >
          <i class="bi bi-plus-circle-fill"></i> Add New Address
        </button>
        
        <div class="row g-3">
          <!-- Address Cards -->
          {% for address in addresss %}
          <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm position-relative">
              {% if address.is_default %}
              <span class="badge bg-warning position-absolute top-0 end-0 m-2">DEFAULT</span>
              {% endif %}
              
              <div class="card-body">
                <div class="mb-3">
                  <span class="badge bg-primary">{{address.address_type}}</span>
                </div>
                
                <div class="mb-3">
                  <p class="mb-1">{{address.street}}</p>
                  <p class="mb-1">{{address.city}}, {{address.landmark}}</p>
                  <p class="mb-1">{{address.state}}, {{address.postal_code}}</p>
                  <p class="mb-0 text-primary">
                    <i class="bi bi-telephone"></i> {{address.phone}}
                  </p>
                </div>

                <div class="d-grid gap-2 mt-auto">
                  <a href="{% url 'address_edit' address.id %}" class="btn btn-sm btn-outline-primary">Edit</a>
                  <a href="{% url 'address_delete' address.id %}" class="btn btn-sm btn-outline-danger">Remove</a>
                  {% if not address.is_default %}
                  <a href="{% url 'default_address' address.id %}" class="btn btn-sm btn-outline-secondary">Set as Default</a>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
          {% empty %}
          <div class="col-12">
            <p class="text-muted">No Addresses found.</p>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Address Modal -->
<div
  class="modal fade"
  id="addAddressModal"
  tabindex="-1"
  aria-labelledby="addAddressModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addAddressModalLabel">Add New Address</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form method="POST" action="{% url 'user_address' %}">
          {% csrf_token %}

          <div class="mb-3">
            <label for="addressNickname" class="form-label">Address Type</label>
            <input
              type="text"
              class="form-control"
              id="addressNickname"
              name="address_type"
              placeholder="e.g. Home, Office, etc."
              required
            />
          </div>

          <div class="row mb-3">
            <div class="col-md-6 mb-3 mb-md-0">
              <label for="street" class="form-label">Street Address</label>
              <input
                type="text"
                class="form-control"
                id="street"
                name="street"
                required
              />
            </div>
            <div class="col-md-6">
              <label for="phoneNumber" class="form-label">Phone Number</label>
              <input
                type="tel"
                class="form-control"
                id="phoneNumber"
                name="phone"
                required
              />
            </div>
          </div>

          <div class="mb-3">
            <label for="addressLine2" class="form-label">Landmark</label>
            <input
              type="text"
              class="form-control"
              id="addressLine2"
              name="landmark"
              placeholder="Optional landmark for easy identification"
            />
          </div>

          <div class="row mb-4">
            <div class="col-md-4 mb-3 mb-md-0">
              <label for="city" class="form-label">City</label>
              <input
                type="text"
                class="form-control"
                id="city"
                name="city"
                required
              />
            </div>
            <div class="col-md-4 mb-3 mb-md-0">
              <label for="state" class="form-label">State</label>
              <input
                type="text"
                class="form-control"
                id="state"
                name="state"
                required
              />
            </div>
            <div class="col-md-4">
              <label for="pincode" class="form-label">PIN Code</label>
              <input
                type="text"
                class="form-control"
                id="pincode"
                name="pincode"
                required
              />
            </div>
          </div>

          <div class="d-flex gap-3 justify-content-end">
            <button
              type="button"
              class="btn btn-outline-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">
              Save Address
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

{% include 'includes/footer.html' %}

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Simple form validation
    const form = document.querySelector("#addAddressModal form");
    if (form) {
      form.addEventListener("submit", function (e) {
        const requiredFields = form.querySelectorAll("[required]");
        let isValid = true;

        requiredFields.forEach((field) => {
          if (!field.value.trim()) {
            field.classList.add("is-invalid");
            isValid = false;
          } else {
            field.classList.remove("is-invalid");
          }
        });

        if (!isValid) {
          e.preventDefault();
          alert("Please fill in all required fields");
        }
      });
    }
  });
</script>
