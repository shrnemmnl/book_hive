{% load static %} 
{% include 'includes/header.html' %}

<style>
  .address-page {
    background: #f8fafc;
    min-height: calc(100vh - 200px);
    padding: 2rem 0;
  }
  
  .address-header {
    background: linear-gradient(135deg, #4a00e0, #8e2de2);
    color: white;
    padding: 1.5rem;
    border-radius: 12px 12px 0 0;
    margin-bottom: 0;
  }
  
  .address-content {
    background: white;
    border-radius: 0 0 12px 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    padding: 2rem;
  }
  
  .address-card {
    border: 1.5px solid #e2e8f0;
    border-radius: 12px;
    transition: all 0.3s ease;
    height: 100%;
    position: relative;
    overflow: hidden;
  }
  
  .address-card:hover {
    border-color: #4a00e0;
    box-shadow: 0 4px 12px rgba(74, 0, 224, 0.1);
    transform: translateY(-2px);
  }
  
  .address-card.default {
    border-color: #fbbf24;
    background: linear-gradient(135deg, #fef3c7, #fde68a);
  }
  
  .default-badge {
    position: absolute;
    top: 12px;
    right: 12px;
    background: #f59e0b;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 600;
  }
  
  .address-type-badge {
    background: linear-gradient(135deg, #4a00e0, #8e2de2);
    color: white;
    padding: 0.4rem 1rem;
    border-radius: 8px;
    font-size: 0.85rem;
    font-weight: 600;
    display: inline-block;
    margin-bottom: 1rem;
  }
  
  .address-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  
  .btn-sm {
    border-radius: 6px;
    font-size: 0.85rem;
    padding: 0.5rem 1rem;
    font-weight: 500;
  }
  
  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
  }
  
  .empty-state-icon {
    font-size: 4rem;
    color: #cbd5e1;
    margin-bottom: 1rem;
  }
  
  .modal-content {
    border-radius: 12px;
    border: none;
  }
  
  .modal-header {
    background: linear-gradient(135deg, #4a00e0, #8e2de2);
    color: white;
    border-radius: 12px 12px 0 0;
    border: none;
  }
  
  .modal-body .form-label {
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }
  
  .modal-body .form-control {
    border: 1.5px solid #e2e8f0;
    border-radius: 8px;
    padding: 0.75rem 1rem;
    transition: all 0.2s ease;
  }
  
  .modal-body .form-control:focus {
    border-color: #4a00e0;
    box-shadow: 0 0 0 3px rgba(74, 0, 224, 0.1);
  }
</style>

<div class="address-page">
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-lg-2 d-none d-lg-block">
        {% include 'user/UserProfile/sidebar.html' %}
      </div>

      <!-- Main Content -->
      <div class="col-lg-10">
        <div class="address-header">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h4 class="mb-0 d-flex align-items-center">
                <i class="bi bi-geo-alt me-2"></i>Your Addresses
              </h4>
              <p class="mb-0 mt-1" style="opacity: 0.9; font-size: 0.9rem;">Manage your delivery addresses</p>
            </div>
            <button class="btn btn-light" data-bs-toggle="modal" data-bs-target="#addAddressModal" style="border-radius: 8px;">
              <i class="bi bi-plus-circle me-2"></i>Add New Address
            </button>
          </div>
        </div>
        
        <div class="address-content">
          <div class="row g-3">
            {% for address in addresss %}
            <div class="col-md-6 col-lg-4">
              <div class="address-card {% if address.is_default %}default{% endif %}">
                {% if address.is_default %}
                <span class="default-badge">
                  <i class="bi bi-star-fill me-1"></i>DEFAULT
                </span>
                {% endif %}
                
                <div class="card-body p-3">
                  <div class="address-type-badge">
                    {{ address.address_type|title }}
                  </div>
                  
                  <div class="address-details" style="color: #1e293b; font-size: 0.9rem; line-height: 1.6;">
                    <p class="mb-2 fw-semibold">{{ address.street }}</p>
                    {% if address.landmark %}
                    <p class="mb-2 text-muted">{{ address.landmark }}</p>
                    {% endif %}
                    <p class="mb-2">{{ address.city }}, {{ address.state }}</p>
                    <p class="mb-2">{{ address.postal_code }}</p>
                    <p class="mb-0">
                      <i class="bi bi-telephone text-primary me-1"></i>
                      <span style="color: #64748b;">{{ address.phone }}</span>
                    </p>
                  </div>

                  <div class="address-actions mt-3 pt-3" style="border-top: 1px solid #e2e8f0;">
                    <a href="{% url 'address_edit' address.id %}" class="btn btn-sm btn-outline-primary">
                      <i class="bi bi-pencil me-1"></i>Edit
                    </a>
                    <a href="{% url 'address_delete' address.id %}" class="btn btn-sm btn-outline-danger" 
                       onclick="return confirm('Are you sure you want to delete this address?')">
                      <i class="bi bi-trash me-1"></i>Remove
                    </a>
                    {% if not address.is_default %}
                    <a href="{% url 'default_address' address.id %}" class="btn btn-sm btn-outline-secondary">
                      <i class="bi bi-star me-1"></i>Set Default
                    </a>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
            {% empty %}
            <div class="col-12">
              <div class="empty-state">
                <div class="empty-state-icon">
                  <i class="bi bi-geo-alt"></i>
                </div>
                <h5 class="mb-2" style="color: #1e293b;">No addresses found</h5>
                <p class="text-muted mb-4">Add your first delivery address to get started</p>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAddressModal" style="border-radius: 8px;">
                  <i class="bi bi-plus-circle me-2"></i>Add Address
                </button>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Address Modal -->
<div class="modal fade" id="addAddressModal" tabindex="-1" aria-labelledby="addAddressModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addAddressModalLabel">
          <i class="bi bi-plus-circle me-2"></i>Add New Address
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4">
        <form method="POST" action="{% url 'user_address' %}">
          {% csrf_token %}
          <div class="mb-3">
            <label for="addressNickname" class="form-label">Address Type</label>
            <input type="text" class="form-control" id="addressNickname" name="address_type" 
                   placeholder="e.g. Home, Office, etc." required />
          </div>

          <div class="row mb-3">
            <div class="col-md-6 mb-3 mb-md-0">
              <label for="street" class="form-label">Street Address</label>
              <input type="text" class="form-control" id="street" name="street" required />
            </div>
            <div class="col-md-6">
              <label for="phoneNumber" class="form-label">Phone Number</label>
              <input type="tel" class="form-control" id="phoneNumber" name="phone" required />
            </div>
          </div>

          <div class="mb-3">
            <label for="addressLine2" class="form-label">Landmark <span class="text-muted">(Optional)</span></label>
            <input type="text" class="form-control" id="addressLine2" name="landmark" 
                   placeholder="Optional landmark for easy identification" />
          </div>

          <div class="row mb-4">
            <div class="col-md-4 mb-3 mb-md-0">
              <label for="city" class="form-label">City</label>
              <input type="text" class="form-control" id="city" name="city" required />
            </div>
            <div class="col-md-4 mb-3 mb-md-0">
              <label for="state" class="form-label">State</label>
              <input type="text" class="form-control" id="state" name="state" required />
            </div>
            <div class="col-md-4">
              <label for="pincode" class="form-label">PIN Code</label>
              <input type="text" class="form-control" id="pincode" name="pincode" required />
            </div>
          </div>

          <div class="d-flex gap-3 justify-content-end">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" style="border-radius: 8px;">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary" style="border-radius: 8px;">
              <i class="bi bi-check-circle me-2"></i>Save Address
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

{% include 'includes/footer.html' %}

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.querySelector("#addAddressModal form");
    if (form) {
      form.addEventListener("submit", function (e) {
        const requiredFields = form.querySelectorAll("[required]");
        let isValid = true;

        requiredFields.forEach((field) => {
          if (!field.value.trim()) {
            field.classList.add("is-invalid");
            isValid = false;
          } else {
            field.classList.remove("is-invalid");
          }
        });

        if (!isValid) {
          e.preventDefault();
          if (typeof toastr !== 'undefined') {
            toastr.error("Please fill in all required fields");
          } else {
            alert("Please fill in all required fields");
          }
        }
      });
    }
  });
</script>
