{% extends "admin/admin_base.html" %}

{% block head %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
{% endblock head %}

{% block heading %}
<h2 class="fw-semibold mb-0" style="font-size: 1.5rem; color: #1e293b;">Variants</h2>
{% endblock heading %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Add Variant Button -->
    <div class="card shadow-sm mb-4" style="border-radius: 10px; border: none;">
        <div class="card-body d-flex justify-content-end" style="padding: 1.5rem;">
            <a href="{% url 'add_variant' first_variant %}" class="btn btn-primary" style="font-size: 0.9rem; padding: 0.5rem 1rem; border-radius: 6px; background-color: #2563eb;">Add Variant</a>
        </div>
    </div>

    <!-- Variants Table -->
    <div class="card shadow-sm mb-4" style="border-radius: 10px; border: none;">
        <div class="card-header" style="border-radius: 10px 10px 0 0; background-color: #f8fafc;">
            <h5 class="mb-0 fw-medium" style="font-size: 1.1rem; color: #1e293b;">Variants</h5>
        </div>
        <div class="card-body" style="padding: 1.5rem;">
            <div class="table-responsive">
                <table class="table table-hover align-middle" style="font-size: 0.9rem;">
                    <thead class="table-light">
                        <tr>
                            <th scope="col" style="color: #1e293b; font-weight: 500;">Sl. No</th>
                            <th scope="col" style="color: #1e293b; font-weight: 500;">Image</th>
                            <th scope="col" style="color: #1e293b; font-weight: 500;">Publisher</th>
                            <th scope="col" style="color: #1e293b; font-weight: 500;">Published Date</th>
                            <th scope="col" style="color: #1e293b; font-weight: 500;">Price</th>
                            <th scope="col" style="color: #1e293b; font-weight: 500;">Available Quantity</th>
                            <th scope="col" style="color: #1e293b; font-weight: 500;">Page</th>
                            <th scope="col" style="color: #1e293b; font-weight: 500;">Language</th>
                            <th scope="col" style="color: #1e293b; font-weight: 500;">Edit</th>
                            <th scope="col" style="color: #1e293b; font-weight: 500;">Status</th>
                            <th scope="col" style="color: #1e293b; font-weight: 500;">Change Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for variant in variants %}
                        <tr>
                            <td style="font-size: 0.85rem;">{{ forloop.counter }}</td>
                            <td>
                                {% if variant.productimage_set.exists %}
                                <img src="{{ variant.productimage_set.first.image1.url }}" alt="Image of Variant" class="img-fluid rounded" style="max-width: 80px; border-radius: 6px;">
                                {% else %}
                                <span class="text-muted" style="font-size: 0.85rem;">No image</span>
                                {% endif %}
                            </td>
                            <td style="font-size: 0.85rem;">{{ variant.publisher|default:"Not provided" }}</td>
                            <td style="font-size: 0.85rem;">{{ variant.published_date|date:"Y-m-d"|default:"Not provided" }}</td>
                            <td style="font-size: 0.85rem;">{{ variant.price|floatformat:2|default:"0.00" }}</td>
                            <td style="font-size: 0.85rem;">{{ variant.available_quantity|default:"0" }}</td>
                            <td style="font-size: 0.85rem;">{{ variant.page|default:"Not provided" }}</td>
                            <td style="font-size: 0.85rem;">{{ variant.language|default:"Not provided" }}</td>
                            <td>
                                <!-- <form action="{% url 'variant_edit' variant.id %}" method="post">
                                    <input type="hidden" name="variant_id" value="{{ variant.id }}">
                                    <button type="submit" class="btn btn-sm btn-primary" style="font-size: 0.85rem; padding: 0.4rem 0.8rem; border-radius: 6px; background-color: #2563eb;">Edit</button>
                                </form> -->
                                <a href="{% url 'variant_edit' variant.id %}" 
   class="btn btn-sm btn-primary"
   style="font-size: 0.85rem; padding: 0.4rem 0.8rem; border-radius: 6px; background-color: #2563eb;">
   Edit
</a>
                            </td>
                            <td>
                                {% if variant.is_active %}
                                    <span class="badge bg-success" style="font-size: 0.8rem; padding: 0.4em 0.7em;">Active</span>
                                {% else %}
                                    <span class="badge bg-danger" style="font-size: 0.8rem; padding: 0.4em 0.7em;">Inactive</span>
                                {% endif %}
                            </td>
                            <td>
                                <button type="button" class="btn btn-sm {% if variant.is_active %}btn-outline-danger{% else %}btn-outline-success{% endif %}" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal{{ variant.id }}" style="font-size: 0.85rem; padding: 0.4rem 0.8rem; border-radius: 6px;">
                                    {% if variant.is_active %}Deactivate{% else %}Activate{% endif %}
                                </button>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="11" class="text-center text-muted" style="font-size: 0.85rem;">No variants found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

{% for variant in variants %}
<!-- Modal -->
<div class="modal fade" id="confirmDeleteModal{{ variant.id }}" tabindex="-1" aria-labelledby="confirmDeleteLabel{{ variant.id }}" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius: 10px; border: none;">
            <div class="modal-header {% if variant.is_active %}bg-danger{% else %}bg-success{% endif %} text-white">
                <h5 class="modal-title fw-medium" id="confirmDeleteLabel{{ variant.id }}" style="font-size: 1.1rem;">Confirm {% if variant.is_active %}Deactivate{% else %}Activate{% endif %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="font-size: 0.9rem; color: #1e293b;">
                Are you sure you want to {% if variant.is_active %}deactivate{% else %}activate{% endif %} this variant ({{ variant.publisher|default:"Unknown" }})? This action cannot be undone.
            </div>
            <div class="modal-footer" style="border-top: none;">
                <form method="post" action="{% url 'variant_delete' %}">
                    {% csrf_token %}
                    <input type="hidden" name="variant_id" value="{{ variant.id }}">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="font-size: 0.9rem; padding: 0.5rem 1rem; border-radius: 6px;">Cancel</button>
                    <button type="submit" class="btn {% if variant.is_active %}btn-danger{% else %}btn-success{% endif %}" style="font-size: 0.9rem; padding: 0.5rem 1rem; border-radius: 6px;">
                        Yes, {% if variant.is_active %}Deactivate{% else %}Activate{% endif %}
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<style>
    .card {
        background-color: #ffffff;
        border: none;
        transition: box-shadow 0.2s ease;
    }
    .card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    .card-header {
        background-color: #f8fafc;
        border-bottom: none;
    }
    .btn-primary, .btn-outline-success, .btn-outline-danger {
        transition: background-color 0.2s ease, color 0.2s ease;
    }
    .btn-primary:hover {
        background-color: #1e40af;
    }
    .btn-outline-success:hover {
        background-color: #16a34a;
        color: #ffffff;
        border-color: #16a34a;
    }
    .btn-outline-danger:hover {
        background-color: #dc2626;
        color: #ffffff;
        border-color: #dc2626;
    }
    .table {
        font-size: 0.9rem;
    }
    .table th {
        color: #1e293b;
        font-weight: 500;
    }
    .table td {
        vertical-align: middle;
    }
    .badge {
        font-size: 0.8rem;
        padding: 0.4em 0.7em;
    }
    .modal-content {
        border: none;
    }
    .modal-header, .modal-footer {
        border: none;
    }
    .img-fluid {
        border-radius: 6px;
    }
</style>
{% endblock %}